<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta nAMe="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Odin-Weather</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">

</head>
<style>
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    
    #map {
        height: 100%;
    }
    /* Optional: Makes the sAMple page fill the window. */
    
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-fAMily: 'Roboto', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    content-wrapper {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
    }
    
    content {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
    }
    
    content card {
        margin: .5rem;
        max-width: 25em;
        box-shadow: rgba(0, 0, 0, 0.15) 0px 3px 3px;
        background-color: white;
        padding: .5em;
    }
    
    card>label:first-of-type {
        font-weight: 500;
        display: block;
        font-size: 1.890625em;
        border-bottom: 2px solid rgba(0, 0, 0, .1);
    }
    
    scroll-flex>item {
        display: flex;
        flex-direction: column;
    }
    
    scroll-flex {
        display: flex;
        flex-direction: row;
        overflow-x: scroll;
        padding-bottom: 1em;
        padding-top: 1em;
    }
    
    carded-grid {
        display: flex;
        flex-direction: row;
        overflow-x: scroll;
        padding-bottom: 1em;
        padding-top: 1em;
        flex-grow: 1;
        flex: 1 1 31%;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    carded-grid item {
        text-align: center;
        /* border: px solid rgba(0, 0, 0, 0.10); */
        margin: .25em .25em;
        padding: 1em 0;
        display: flex;
        flex-direction: column;
        width: 6em;
        color: black;
        font-weight: 600;
        border-radius: .25em;
    }
    
    scroll-flex item {
        text-align: center;
        display: flex;
        flex-direction: column;
        overflow-x: scroll;
        min-width: 4em;
        justify-content: center;
        justify-items: center;
        font-weight: 600;
        width: 100%;
    }
    
    scroll-flex item span:first-of-type {
        font-size: 1.375em;
        font-weight: 800;
    }
    
    scroll-flex item span:last-of-type {
        font-size: 1em;
        font-weight: 600;
        color: rgba(0, 0, 0, 0.24)
    }
    
    scroll-flex img {
        margin-top: .25rem;
    }
    
    card input {
        width: 93.5%;
        padding: .4em .5em;
        font-size: 1em;
        border: none;
        outline: none;
    }
    
    card-wrapper {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }
    
    button-grid {
        display: flex;
        flex-direction: row;
    }
    
    title {
        display: inline;
        color: black;
        font-weight: 600;
        font-size: 1.375em;
    }
    
    .search-results {
        transition-duration: 355ms;
        display: flex;
        max-width: 20rem;
        min-width: 20rem;
        min-height: 20em !important;
        max-height: 2em !important;
        align-self: center;
        margin-top: 0;
        flex-direction: column;
        overflow-y: scroll;
        pointer-events: all;
        opacity: 1;
    }
    
    .search-results.active {
        transition-duration: 355ms;
        display: flex;
        max-width: 0;
        background-color: unset;
        box-shadow: unset;
        opacity: 0;
        min-width: 0;
        min-height: 0 !important;
        max-height: 0 !important;
        align-self: center;
        margin-top: 0;
        flex-direction: column;
        overflow-y: scroll;
        pointer-events: all;
    }
    
    wrapped-sections>scroll-flex {
        position: absolute;
        overflow-x: hidden;
        max-width: 25em;
        min-width: 25em;
        opacity: 0;
        left: .8rem;
        display: flex;
        transition-duration: 355ms;
        flex-direction: row;
        justify-content: center;
    }
    
    wrapped-sections>scroll-flex.active {
        opacity: 1;
        transition-duration: 355ms;
        left: 0rem;
    }
    
    wrapped-sections {
        display: block;
        min-height: 10em;
    }
    
    img-wrap {
        min-height: 2.4rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    
    state {
        height: 0;
        width: 0;
        transition-duration: 355ms;
        overflow: hidden;
        opacity: 0;
    }
    
    state.active {
        height: unset;
        width: unset;
        overflow: unset;
        opacity: 1;
        transition-duration: 355ms;
    }

    .hidden {
        opacity: 0;
        transition-duration: 355ms;
    }
</style>

<body>
    <div id="map"></div>
    <content-wrapper style="pointer-events: none;">
        <content id="ux">
            <card-wrapper style="position: relative;">
                <card id="cardinfo" style="margin-left: 3em;">
                    <label>Odin-Weather</label><br>
                    <title>30 C 31 / 23</title><br>
                    <label>Octubre 11, 2019</label><br>
                    <label>Santo Domingo</label><br>
                    <label>Clear sky</label><br>
                    <title>Today - Moderate rain. Hight 31 C low 24 C, Wind southwest at 4 mph. Chance of precipitation 85%
                    </title><br>

                    <wrapped-sections style="position: relative;">

                        <scroll-flex id="firstfivedays" class="active" style="pointer-events: all;">
                            <item>
                                <span>30 C</span>
                                <span style="margin:1rem 0;;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>6 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>7 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>8 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>9 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>10 AM</span>
                            </item>
                        </scroll-flex>

                    </wrapped-sections>

                    <button-grid>
                        <input type="button" value="close" style="font-weight: 600;">
                        <input type="button" value="reset" style="font-weight: 600;">
                    </button-grid>
                    
                </card>

                <card id="loadingsvg" class="hidden" style="position: absolute;right:0;bottom: 0;">  
                    <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
                        <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
                          s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
                          c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
                        <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
                          C22.32,8.481,24.301,9.057,26.013,10.047z">
                          <animateTransform attributeType="xml"
                            attributeName="transform"
                            type="rotate"
                            from="0 20 20"
                            to="360 20 20"
                            dur="0.5s"
                            repeatCount="indefinite"/>
                          </path>
                        </svg>
                </card>
            </card-wrapper>



        </content>

    </content-wrapper>
    <content-wrapper style="pointer-events: none;">

        <content id="ux1" style="justify-content: flex-start;flex-direction: column;">
            <card style="max-width: 20rem;min-width: 20rem;min-height: 2em !important;max-height: 2em !important;align-self: center;margin-bottom: 0;">

                <input placeholder="Type any place" value="Dominican" minlength="5" maxlength="20" type="text" style='pointer-events: all;' required="required">
            </card>
            <card class="search-results active">
                <state class="ready active">
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                </state>
                <state class="loading" style="text-align: center;font-weight: 500;transition-duration: 355ms;">
                    Loading
                </state>

            </card>


        </content>
    </content-wrapper>
</body>


<script>
</script>

<script type="text/javascript">
    var map;
    var geocoder;
    let userinput = document.querySelector("input[placeholder='Type any place']");
    let cardsstateready = document.querySelector("card.search-results.active");
    let thereisarequest = false;
    let service = undefined;
    let initialized = false;
    let resultscontainer = document.querySelector("card > state.ready");

    let initialindex = 0;
    var placeselected = "";
    var list = document.querySelectorAll('wrapped-sections > scroll-flex');
    var map;
    // var timer = setInterval(nextSectionWeather, 3000);


    function nextSectionWeather() {
        initialindex += 1;
        initialindex %= 3;
        // console.log(initialindex)
        list.forEach((value, index) => {
            // console.log(index)
            if (index == initialindex) {
                list[index].classList.add("active")
            } else {
                list[index].classList.remove("active")
            }
        })

    }


    function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: -34.397,
                lng: 150.644
            },
            zoom: 8,
            disableDefaultUI: true
        });
    }

    function codeAddress(place_id) {
        document.querySelector("#loadingsvg").classList.remove('hidden');
        document.querySelector(".search-results").classList.toggle("active");

        geocoder.geocode({
            placeId: place_id
        }, function(results, status) {
            if (status == 'OK') {
                map.setCenter(results[0].geometry.location);
                fetchWeather(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
                document.querySelector("#loadingsvg").classList.add('hidden');
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }

    function setLocation(lat) {
        map.map.setCenter(new google.maps.LatLng(45, 19));
    }

    const switchthis = () => {
        document.querySelector(".search-results").classList.toggle("active");
    }

    function iLikeit() {
        document.querySelectorAll("card.search-results > state").forEach(value => {
            value.classList.toggle("active")
        });
    }

    // if (document.querySelector('#test').reportValidity()) { findTicket() }
    // var key = [...form.elements].reduce((map, input) => { (input.type == 'checkbox') ? map[input.name] = input.checked : map[input.name] = input.value; return map }, {})
    window.onload = () => {
        initMap();
    }
    const displaySuggestions = function(predictions, status) {
        if (status != google.maps.places.PlacesServiceStatus.OK) {
            alert(status);
            return;
        }

        predictions.forEach(function(prediction) {
            console.log(prediction)
            let item = document.createElement('item');

            item.addEventListener('click', () => {
                placeselected = prediction.description;
                codeAddress(prediction.place_id);
            })

            item.setAttribute("style", "display: flex;flex-direction: column;padding: .5em .5em;border-bottom: 1px solid rgba(0,0,0,.10);");

            let itemtitle = document.createElement('title');
            let itemspan = document.createElement('span');

            itemtitle.innerHTML = prediction.description;
            itemspan.innerHTML = prediction.types[0];

            item.appendChild(itemtitle);
            item.appendChild(itemspan);

            resultscontainer.appendChild(item);
            console.log(prediction)
                // var li = document.createElement('li');
                // li.appendChild(document.createTextNode(prediction.description));
                // document.getElementById('results').appendChild(li);
        });

        iLikeit();
    };

    function initService() {
        service = new google.maps.places.AutocompleteService();
        service.getQueryPredictions({
            input: userinput.value
        }, displaySuggestions);
    }

    function getResults() {
        iLikeit();
        resultscontainer.innerHTML = "";
        if (initialized) {
            service.getQueryPredictions({
                input: userinput.value
            }, displaySuggestions);
        } else {
            service = new google.maps.places.AutocompleteService();
            service.getQueryPredictions({
                input: userinput.value
            }, displaySuggestions);
        }
    }

    const autoComplete = () => {

        let defaultBounds = new google.maps.LatLngBounds(
            new google.maps.LatLng(-33.8902, 151.1759),
            new google.maps.LatLng(-33.8474, 151.2631));

        let input = document.getElementById('searchTextField');
        let options = {
            bounds: defaultBounds,
            types: ['establishment']
        };

        if (userinput.checkValidity() && !thereisarequest) {
            debugger;
            let text = userinput.value;
            var autocompleted = new google.maps.places.Autocomplete(userinput, options);
            console.log(autocompleted);
        }

    }

    document.querySelector("input[placeholder='Type any place']").addEventListener('keyup', () => {
        if (document.querySelector("input[placeholder='Type any place']").checkValidity()) {
            document.querySelector(".search-results").classList.remove("active");
            getResults()
        } else {
            document.querySelector(".search-results").classList.add("active");
        }
    })

    const fetchWeather = ({
        lat,
        lng
    }) => {
        debugger;
        var data = null;

        var xhr = new XMLHttpRequest();

        xhr.addEventListener("readystatechange", function() {

            if (this.readyState === this.DONE) {
                debugger;
                let data = JSON.parse(this.responseText).data;
                console.log(JSON.parse(this.responseText));

                let card = `
                    <label>Odin-Weather</label><br>
                    <title>${data[0].temp} ${data[0].max_temp} C / ${data[0].low_temp} C</title><br>
                    <label>${data[0].valid_date}</label><br>
                    <label>${placeselected}</label><br>
                    <label>${data[0].weather.description}</label><br>
                    <title>Today - ${data[0].weather.description}. Hight ${data[0].max_temp} C low ${data[0].low_temp} C, ${data[0].weather.description}.</title><br>

                    <wrapped-sections style="position: relative;">

                        <scroll-flex id="firstfivedays" class="active" style="pointer-events: all;">
                            <item>
                                <span>${data[0].temp} C</span>
                                <span style="margin:1rem 0;;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>Today</span>
                            </item>
                            <item>
                                <span>${data[1].temp} C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>Tomorrow</span>
                            </item>
                            <item>
                                <span>${data[2].temp} C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>+ 1</span>
                            </item>
                            <item>
                                <span>${data[3].temp} C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>+ 2</span>
                            </item>
                            <item>
                                <span>${data[4].temp} C</span>
                                <span style="margin:1rem 0;align-self: center;;display: flex;width:1.5rem;height:1.5rem;background: red;border-radius: 2rem;"></span>
                                <span>+ 3</span>
                            </item>
                        </scroll-flex>
                    </wrapped-sections>
                    <button-grid>
                        <input type="button" value="close" style="font-weight: 600;">
                        <input type="button" value="reset" style="font-weight: 600;">
                    </button-grid>
                    `
                document.querySelector("#cardinfo").innerHTML = card;
            }
        });

        let thislat = lat();
        let thislng = lng();
        xhr.open("get", `./getweather?lat=${thislat}&long=${thislng}`);

        xhr.send(data);
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDy1YJbwCvAxZJTwxq3Qw_j8BIb2DGXSNM&libraries=places"></script>








</html>