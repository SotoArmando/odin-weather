<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta nAMe="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Odin-Weather</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">

</head>
<style>
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    
    #map {
        height: 100%;
    }
    /* Optional: Makes the sAMple page fill the window. */
    
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-fAMily: 'Roboto', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    content-wrapper {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
    }
    
    content {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
    }
    
    content card {
        margin: .5rem;
        max-width: 25em;
        box-shadow: rgba(0, 0, 0, 0.15) 0px 3px 3px;
        background-color: white;
        padding: .5em;
    }
    
    card>label:first-of-type {
        font-weight: 500;
        display: block;
        font-size: 1.890625em;
        border-bottom: 2px solid rgba(0, 0, 0, .1);
    }
    
    scroll-flex>item {
        display: flex;
        flex-direction: column;
    }
    
    scroll-flex {
        display: flex;
        flex-direction: row;
        overflow-x: scroll;
        padding-bottom: 1em;
        padding-top: 1em;
    }
    
    carded-grid {
        display: flex;
        flex-direction: row;
        overflow-x: scroll;
        padding-bottom: 1em;
        padding-top: 1em;
        flex-grow: 1;
        flex: 1 1 31%;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    carded-grid item {
        text-align: center;
        /* border: px solid rgba(0, 0, 0, 0.10); */
        margin: .25em .25em;
        padding: 1em 0;
        display: flex;
        flex-direction: column;
        width: 6em;
        color: black;
        font-weight: 600;
        border-radius: .25em;
    }
    
    scroll-flex item {
        text-align: center;
        display: flex;
        flex-direction: column;
        overflow-x: scroll;
        min-width: 4em;
        justify-content: center;
        justify-items: center;
        font-weight: 600;
    }
    
    scroll-flex item span:first-of-type {
        font-size: 1.375em;
        font-weight: 800;
    }
    
    scroll-flex item span:last-of-type {
        font-size: 1em;
        font-weight: 600;
        color: rgba(0, 0, 0, 0.24)
    }
    
    scroll-flex img {
        margin-top: .25rem;
    }
    
    card input {
        width: 93.5%;
        padding: .4em .5em;
        font-size: 1em;
        border: none;
        outline: none;
    }
    
    card-wrapper {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }
    
    button-grid {
        display: flex;
        flex-direction: row;
    }
    
    title {
        display: inline;
        color: black;
        font-weight: 600;
        font-size: 1.375em;
    }
    
    .search-results {
        transition-duration: 355ms;
        display: flex;
        max-width: 20rem;
        min-width: 20rem;
        min-height: 20em !important;
        max-height: 2em !important;
        align-self: center;
        margin-top: 0;
        flex-direction: column;
        overflow-y: scroll;
        pointer-events: all;
        opacity: 1;
    }
    
    .search-results.active {
        transition-duration: 355ms;
        display: flex;
        max-width: 0;
        background-color: unset;
        box-shadow: unset;
        opacity: 0;
        min-width: 0;
        min-height: 0 !important;
        max-height: 0 !important;
        align-self: center;
        margin-top: 0;
        flex-direction: column;
        overflow-y: scroll;
        pointer-events: all;
    }
    
    wrapped-sections>scroll-flex {
        position: absolute;
        overflow-x: hidden;
        max-width: 25em;
        min-width: 25em;
        opacity: 0;
        left: .8rem;
        display: flex;
        transition-duration: 355ms;
        flex-direction: row;
        justify-content: center;
    }
    
    wrapped-sections>scroll-flex.active {
        opacity: 1;
        transition-duration: 355ms;
        left: 0rem;
    }
    
    wrapped-sections {
        display: block;
        min-height: 7em;
    }
    
    img-wrap {
        min-height: 2.4rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    
    state {
        height: 0;
        width: 0;
        transition-duration: 355ms;
        overflow: hidden;
        opacity: 0;
    }
    
    state.active {
        height: unset;
        width: unset;
        overflow: unset;
        opacity: 1;
        transition-duration: 355ms;
    }
</style>

<body>
    <div id="map"></div>
    <content-wrapper style="pointer-events: none;">
        <content id="ux">
            <card-wrapper>
                <card style="margin-left: 3em;">
                    <label>Odin-Weather</label><br>
                    <title>30 C 31 / 23</title><br>
                    <label>Octubre 11, 2019</label><br>
                    <label>Santo Domingo</label><br>
                    <label>Clear sky</label><br>
                    <title>Today - Moderate rain. Hight 31 C low 24 C, Wind southwest at 4 mph. Chance of precipitation 85%
                    </title><br>

                    <wrapped-sections style="position: relative;">

                        <scroll-flex class="active" style="pointer-events: all;">
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 47.svg"></img-wrap>
                                <span>6 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 47.svg"></img-wrap>
                                <span>7 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 47.svg"></img-wrap>
                                <span>8 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 47.svg"></img-wrap>
                                <span>9 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 47.svg"></img-wrap>
                                <span>10 AM</span>
                            </item>
                        </scroll-flex>
                        <scroll-flex class="" style="pointer-events: all;">
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 48.svg"></img-wrap>
                                <span>11 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 48.svg"></img-wrap>
                                <span>12 AM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 48.svg"></img-wrap>
                                <span>1 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 48.svg"></img-wrap>
                                <span>2 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 48.svg"></img-wrap>
                                <span>3 PM</span>
                            </item>
                        </scroll-flex>
                        <scroll-flex class="" style="pointer-events: all;">
                            <item>
                                <span>30 C</span>

                                <img-wrap><img width="38" src="./svg/group 45.svg"></img-wrap>
                                <span>4 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 45.svg"></img-wrap>
                                <span>5 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 45.svg"></img-wrap>
                                <span>6 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 45.svg"></img-wrap>
                                <span>7 PM</span>
                            </item>
                            <item>
                                <span>30 C</span>
                                <img-wrap><img width="38" src="./svg/group 45.svg"></img-wrap>
                                <span>8 PM</span>
                            </item>
                        </scroll-flex>

                    </wrapped-sections>

                    <carded-grid>

                        <item><span>30 C</span><span>Feels Like</span><span>39 C</span></item>
                        <item><span>30 C</span><span>Humidity</span><span>83 %</span></item>
                        <item><span>30 C</span><span>Dew Point</span><span>27 C</span></item>


                    </carded-grid>
                    <button-grid>
                        <input type="button" value="close" style="font-weight: 600;">
                        <input type="button" value="reset" style="font-weight: 600;">
                    </button-grid>
                </card>
            </card-wrapper>



        </content>

    </content-wrapper>
    <content-wrapper style="pointer-events: none;">

        <content id="ux1" style="justify-content: flex-start;flex-direction: column;">
            <card style="max-width: 20rem;min-width: 20rem;min-height: 2em !important;max-height: 2em !important;align-self: center;margin-bottom: 0;">

                <input placeholder="Type any place" value="Dominican" minlength="5" maxlength="20" type="text" style='pointer-events: all;' required="required">
            </card>
            <card class="search-results active">
                <state class="ready active">
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                    <item style="display: flex;flex-direction: column;    padding: .5em .5em;
                        border-bottom: 1px solid rgba(0,0,0,.10);">
                        <title>Titulo</title>
                        <span>Country - State</span>
                    </item>
                </state>
                <state class="loading" style="text-align: center;font-weight: 500;">
                    Loading
                </state>

            </card>


        </content>
    </content-wrapper>
</body>


<script>
</script>

<script type="text/javascript">
    var map;
    var geocoder;
    let userinput = document.querySelector("input[placeholder='Type any place']");
    let cardsstateready = document.querySelector("card.search-results.active");
    let thereisarequest = false;
    let service = undefined;
    let initialized = false;
    let resultscontainer = document.querySelector("card > state.ready");

    let initialindex = 0;
    var list = document.querySelectorAll('wrapped-sections > scroll-flex');
    var map;
    var timer = setInterval(nextSectionWeather, 3000);


    function nextSectionWeather() {
        initialindex += 1;
        initialindex %= 3;
        // console.log(initialindex)
        list.forEach((value, index) => {
            // console.log(index)
            if (index == initialindex) {
                list[index].classList.add("active")
            } else {
                list[index].classList.remove("active")
            }
        })

    }


    function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: -34.397,
                lng: 150.644
            },
            zoom: 8,
            disableDefaultUI: true
        });
    }

    function codeAddress(place_id) {
        document.querySelector(".search-results").classList.toggle("active");
        
        geocoder.geocode({
            placeId: place_id
        }, function(results, status) {
            if (status == 'OK') {
                map.setCenter(results[0].geometry.location);
                fetchWeather(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }

    function setLocation(lat) {
        map.map.setCenter(new google.maps.LatLng(45, 19));
    }

    const switchthis = () => {
        document.querySelector(".search-results").classList.toggle("active");
    }

    function iLikeit() {
        document.querySelectorAll("card.search-results > state").forEach(value => {
            value.classList.toggle("active")
        });
    }

    // if (document.querySelector('#test').reportValidity()) { findTicket() }
    // var key = [...form.elements].reduce((map, input) => { (input.type == 'checkbox') ? map[input.name] = input.checked : map[input.name] = input.value; return map }, {})
    window.onload = () => {
        initMap();
    }
    const displaySuggestions = function(predictions, status) {
        if (status != google.maps.places.PlacesServiceStatus.OK) {
            alert(status);
            return;
        }

        predictions.forEach(function(prediction) {
            console.log(prediction)
            let item = document.createElement('item');

            item.addEventListener('click', () => {
                codeAddress(prediction.place_id);
            })

            item.setAttribute("style", "display: flex;flex-direction: column;padding: .5em .5em;border-bottom: 1px solid rgba(0,0,0,.10);");

            let itemtitle = document.createElement('title');
            let itemspan = document.createElement('span');

            itemtitle.innerHTML = prediction.description;
            itemspan.innerHTML = prediction.types[0];

            item.appendChild(itemtitle);
            item.appendChild(itemspan);

            resultscontainer.appendChild(item);
            console.log(prediction)
                // var li = document.createElement('li');
                // li.appendChild(document.createTextNode(prediction.description));
                // document.getElementById('results').appendChild(li);
        });

        iLikeit();
    };

    function initService() {
        service = new google.maps.places.AutocompleteService();
        service.getQueryPredictions({
            input: userinput.value
        }, displaySuggestions);
    }

    function getResults() {
        iLikeit();
        resultscontainer.innerHTML = "";
        if (initialized) {
            service.getQueryPredictions({
                input: userinput.value
            }, displaySuggestions);
        } else {
            service = new google.maps.places.AutocompleteService();
            service.getQueryPredictions({
                input: userinput.value
            }, displaySuggestions);
        }
    }

    const autoComplete = () => {

        let defaultBounds = new google.maps.LatLngBounds(
            new google.maps.LatLng(-33.8902, 151.1759),
            new google.maps.LatLng(-33.8474, 151.2631));

        let input = document.getElementById('searchTextField');
        let options = {
            bounds: defaultBounds,
            types: ['establishment']
        };

        if (userinput.checkValidity() && !thereisarequest) {
            debugger;
            let text = userinput.value;
            var autocompleted = new google.maps.places.Autocomplete(userinput, options);
            console.log(autocompleted);
        }

    }

    document.querySelector("input[placeholder='Type any place']").addEventListener('keyup', () => {
        if (document.querySelector("input[placeholder='Type any place']").checkValidity()) {
            document.querySelector(".search-results").classList.remove("active");
            getResults()
        } else {
            document.querySelector(".search-results").classList.add("active");
        }
    })

    const fetchWeather = ({lat,lng}) => {
        debugger;
        var data = null;

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function() {
            if (this.readyState === this.DONE) {
                console.log(JSON.parse(this.responseText));
            }
        });

        xhr.open("GET", `./getweather?lat=${lat()}&long=${lng()}`);


        xhr.send(data);
    }

    
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDy1YJbwCvAxZJTwxq3Qw_j8BIb2DGXSNM&libraries=places"></script>








</html>